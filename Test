package com.bcuspublic.wcm.service.offerproduct;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertTrue;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.Mockito.when;

import java.util.Arrays;
import java.util.List;

import org.apache.sling.api.resource.Resource;
import org.apache.sling.api.resource.ResourceResolver;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mock;
import org.mockito.junit.MockitoJUnitRunner;

// Adjust imports to your actual classes / packages
// import com.bcuspublic.wcm.models.offerproduct.OfferProductOptimized;
// import com.bcuspublic.wcm.models.offerproduct.MomProductCode;

@RunWith(MockitoJUnitRunner.class)
public class OfferProductUtilTest {

    @Mock
    private ResourceResolver resourceResolver;

    @Mock
    private Resource resource;

    @Mock
    private OfferProductOptimized offerProductData;

    @Mock
    private MomProductCode momProductCode1;

    @Mock
    private MomProductCode momProductCode2;

    @Test
    public void testGetMpcCodeList_returnsCodesWhenPresent() {
        String offerProductId = "ff64552f-5119-42ef-9485-656d1ad239e19";

        // resourceResolver.getResource(...) -> resource
        when(resourceResolver.getResource(anyString())).thenReturn(resource);

        // resource.adaptTo(OfferProductOptimized.class) -> offerProductData
        when(resource.adaptTo(OfferProductOptimized.class)).thenReturn(offerProductData);

        // offerProductData.getMomProductCodeVO() -> list with one null in between
        List<MomProductCode> momCodes =
                Arrays.asList(momProductCode1, null, momProductCode2);
        when(offerProductData.getMomProductCodeVO()).thenReturn(momCodes);

        // Mom product codes
        when(momProductCode1.getMomProductCode()).thenReturn("mpc1");
        when(momProductCode2.getMomProductCode()).thenReturn("mpc2");

        // call method under test
        List<String> result =
                OfferProductUtil.getMpcCodeList(offerProductId, resourceResolver);

        // assertions
        assertNotNull(result);
        assertEquals(2, result.size());
        assertEquals(Arrays.asList("mpc1", "mpc2"), result);
    }

    @Test
    public void testGetMpcCodeList_returnsEmptyWhenNoOfferProductData() {
        String offerProductId = "some-id";

        // resourceResolver returns a resource, but adaptTo returns null
        when(resourceResolver.getResource(anyString())).thenReturn(resource);
        when(resource.adaptTo(OfferProductOptimized.class)).thenReturn(null);

        // call method under test
        List<String> result =
                OfferProductUtil.getMpcCodeList(offerProductId, resourceResolver);

        // assertions
        assertNotNull(result);
        assertTrue(result.isEmpty());
    }
}
