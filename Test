// ---- NEW: always call servlet to handle MPC-style vanity URLs ----
if ($("input[name='./sling:vanityPath']").length === 0) {
    return;
}

$.ajax({
    url: "/bin/bcuspublic/offerproductmpccodes",
    type: "GET",
    dataType: "json",
    data: { offerProductId: offerProdId }
}).done(function (mpcCodes) {

    if (!mpcCodes || !mpcCodes.length) {
        return;
    }

    // Convert to Set for O(1) lookups
    var mpcSet = new Set(mpcCodes);

    $("input[name='./sling:vanityPath']").each(function () {

        var vanity = this.value || "";

        // Extract last segment after the final slash
        var idx = vanity.lastIndexOf("/");
        var lastSeg = (idx === -1) ? vanity : vanity.substring(idx + 1);

        // Direct constant-time check
        if (mpcSet.has(lastSeg)) {
            $(this).parent().closest("coral-multifield-item").remove();
            $(this).parent().closest("li").remove();
        }
    });
});
